#include <secret.h>
#include <stdio.h>
#include <time.h>

unsigned long time_guess(const char *guess) {
    struct timespec t1;
    timespec_get(&t1, TIME_UTC);
    test_secret(guess);
    struct timespec t2;
    timespec_get(&t2, TIME_UTC);
    int secs = t2.tv_sec - t1.tv_sec;
    return ((t2.tv_nsec - t1.tv_nsec) / 1000) + (secs * 1000000);
}

void guess_secret() {
    // this is a extremely simple algo that can definitely be improved on _a lot_
    char guess[7] = {'0', '0', '0', '0', '0', '0', '\0'};

    unsigned long guess_idx = 0;
    while (guess_idx < (sizeof(guess) - 1)) {
        unsigned long slowest_tm = 0;
        char slowest_char = '0';
        
        for(int i = 0; i < 10; i++) {
            unsigned int t = time_guess(guess);
            if(t >= slowest_tm) {
                slowest_tm = t;
                slowest_char = guess[guess_idx];
            }
            printf("t for '%c' %u\n", guess[guess_idx], t);
            guess[guess_idx]++;
        }
        guess[guess_idx] = slowest_char;
        guess_idx++;

        printf("current guess: %s\n", guess);
    }
    printf("final guess: %s\n", guess);
}

int main() {
    guess_secret();
    return 0;
}
